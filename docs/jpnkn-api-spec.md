# jpnkn Fast インターフェイス (MQTT) 仕様書

本アプリが利用している jpnkn のリアルタイム配信インターフェイスに関する技術仕様です。

## 出典
- [jpnkn 開発者向け機能](https://doc.bbs.jpnkn.com/dev.html#mqtt%E9%80%9A%E4%BF%A1)

## MQTT 接続情報
ユーザー権限は **Read Only** です。以下のいずれかのサーバーを利用します。

### サーバー1
- **アドレス**: `bbs.jpnkn.com`
- **ポート**: `1883`
- **ユーザー名**: `genkai`
- **パスワード**: `7144`
- **購読トピック**: `bbs/{board_id}`

### サーバー2 (代替)
- **アドレス**: `a.mq.jpnkn.com`
- **ポート**: `1884`
- **ユーザー名**: `genkai`
- **パスワード**: `7144`
- **購読トピック**: `bbs/{board_id}`

## メッセージ形式 (JSON)
新着レス発生時に配信されるメッセージの構造です。

```json
{
  "board": "板ID",
  "thread": "スレッドID",
  "num": 123,
  "name": "名前",
  "mail": "メール欄(sage等)",
  "date": "2026/02/02(月) 21:00:00",
  "id": "ユーザーID",
  "message": "レス本文",
  "is_new": true
}
```

## 実装上の注意点
1. **購読トピックの接頭辞**: 
   公式仕様に基づき、トピック名は `bbs/` で始まる必要があります。
2. **メッセージフィルタリング**: 
   `is_new: true` のメッセージを対象として処理を行うことで、過去ログとの混同を避けます。
