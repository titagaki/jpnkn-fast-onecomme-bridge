# jpnkn Fast インターフェイス (MQTT/WebSocket) 仕様書

本アプリが利用している jpnkn のリアルタイム配信インターフェイスに関する技術仕様です。

## 出典
- [jpnkn 開発者向け機能 - Fast インターフェイス](https://doc.bbs.jpnkn.com/dev.html#mqtt%E9%80%9A%E4%BF%A1)

## 接続仕様
- **プロトコル**: MQTT (WebSocket over MQTT)
- **エンドポイント**: `wss://fast.jpnkn.com/`
- **Topic 形式**:
  - 特定のスレッドを購読する場合: `{board_id}/{thread_id}`
  - 板全体の全スレッドを購読する場合: `{board_id}/+`
  - 全ての板・スレッドを購読する場合: `+/+`

## メッセージ形式 (JSON)
新着レス発生時に配信されるメッセージの構造は以下の通りです。

```json
{
  "board": "板ID",
  "thread": "スレッドID",
  "num": 123,
  "name": "名前",
  "mail": "メール欄(sage等)",
  "date": "2026/02/02(月) 21:00:00",
  "id": "ユーザーID",
  "message": "レス本文",
  "is_new": true
}
```

## 実装上の注意点
1. **ワイルドカード購読**: 
   公式ドキュメント通り、トピックに `+` を使用することで、特定の板や全板の新着レスを網羅的に取得可能です。
2. **メッセージフィルタリング**: 
   本アプリでは `is_new: true` のメッセージを対象として処理を行います（過去ログの再送と区別するため）。
3. **文字エンコーディング**: 
   JSON形式で配信されるため、UTF-8として処理します。
